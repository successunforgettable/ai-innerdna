import OpenAI from 'openai';
import fs from 'fs';

const openai = new OpenAI({ 
  apiKey: process.env.OPENAI_API_KEY,
  timeout: 45000,
  maxRetries: 2
});

async function generateSentinel8Complete() {
  try {
    console.log('Generating complete Sentinel 8 transformation report...');
    
    const response = await openai.chat.completions.create({
      model: 'gpt-4o',
      messages: [
        {
          role: 'system',
          content: 'You are an expert transformation coach specializing in Sentinel 8 patterns. Generate complete, authentic transformation report content based on real Sentinel 8 psychology. Be precise and professional.'
        },
        {
          role: 'user',
          content: `Generate complete Sentinel 8 transformation report content for:
- Profile: 60% destructive/40% good states
- Subtype: Self-preservation dominant, sexual blind
- Confidence: 85%

Required JSON structure:
{
  "heroTitle": "Transformation journey title",
  "brainHeartDisconnect": "Warning message like PROTECTIVE CONTROL DETECTED",
  "stage1Description": "60-80 words about ordinary world",
  "challengeCards": [
    {"title": "", "description": "40-60 words", "icon": "fas fa-icon"}
  ],
  "wheelOfLife": [
    {"area": "", "percentage": number, "description": "30-40 words"}
  ],
  "testimonials": [
    {"quote": "40-60 words", "name": "", "title": ""}
  ],
  "heroJourneyStages": {
    "stage2": "60-80 words",
    "stage3": "60-80 words", 
    "stage4": "60-80 words",
    "stage5": "60-80 words",
    "stage6": "60-80 words"
  },
  "callToAction": "50-80 words"
}

Generate 4 challenge cards, 8 wheel areas (Career, Relationships, Health, Finance, Personal Growth, Family, Recreation, Contribution), 4 testimonials. Focus on Sentinel 8 control/protection patterns, self-preservation themes, authority dynamics.`
        }
      ],
      response_format: { type: 'json_object' },
      temperature: 0.7,
      max_tokens: 4000
    });

    const content = JSON.parse(response.choices[0].message.content);
    
    // Save the complete report
    fs.writeFileSync('sentinel-8-complete.json', JSON.stringify(content, null, 2));
    
    console.log('âœ… Complete Sentinel 8 report generated by ChatGPT/OpenAI GPT-4o');
    console.log('Hero Title:', content.heroTitle);
    console.log('Disconnect:', content.brainHeartDisconnect);
    console.log('Challenge Cards:', content.challengeCards?.length || 0);
    console.log('Wheel Areas:', content.wheelOfLife?.length || 0);
    console.log('Testimonials:', content.testimonials?.length || 0);
    console.log('Journey Stages:', Object.keys(content.heroJourneyStages || {}).length);
    console.log('Total Content Length:', JSON.stringify(content).length, 'characters');
    
    return content;
    
  } catch (error) {
    console.error('Generation Error:', error.message);
    throw error;
  }
}

generateSentinel8Complete();