import OpenAI from 'openai';
import fs from 'fs';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY
});

async function generateFullySentinelReport() {
  console.log('🤖 ChatGPT generating complete accurate Sentinel 8 report...');
  
  try {
    const response = await openai.chat.completions.create({
      model: "gpt-4o", // the newest OpenAI model is "gpt-4o" which was released May 13, 2024. do not change this unless explicitly requested by the user
      messages: [
        {
          role: "system",
          content: `Generate a complete personalized transformation report for The Sentinel personality type.

MANDATORY EXACT DATA - NO CHANGES ALLOWED:
- 60% destructive state, 40% good state
- 35% confidence level
- Sexual dominant subtype with social blind spots
- Wheel of Life: Career 25%, Relationships 30%, Health 35%, Spirituality 20%, Personal Growth 25%, Finances 30%

CONTROL DEPENDENCY DETECTED brain-heart disconnect message required.

Generate COMPLETE HTML content by replacing ALL placeholders in the template. Include ALL sections with realistic content for someone struggling with control issues.

Take the challenger template and replace:
{{HERO_TITLE}} - Hero section title
{{HERO_SUBTITLE}} - Hero subtitle
{{STAGE1_TITLE}} - Current reality title
{{STAGE1_DESCRIPTION}} - Detailed description with EXACT percentages (60%/40%)
{{ASSESSMENT_SUMMARY}} - Summary with 35% confidence
{{STAGE2_TITLE}} - Challenge section
{{STAGE2_DESCRIPTION}} - Challenge content
{{TRANSFORMATION_CONTENT}} - All transformation stages
{{LIFE_AREAS_CONTENT}} - Complete life areas with exact low scores
{{TESTIMONIALS}} - Testimonials for control types
{{CONCLUSION}} - Conclusion content

Replace ALL statistics in HTML with correct numbers:
- Any 70% becomes 60%
- Any 30% becomes 40% 
- Any 85% confidence becomes 35%
- Any high wheel scores become the low scores provided

Generate as complete HTML file ready to save.`
        }
      ]
    });

    const completeHTML = response.choices[0].message.content;
    
    // Save the complete report
    fs.writeFileSync('sentinel-8-fully-automated.html', completeHTML);
    console.log('✅ Complete Sentinel 8 report generated by ChatGPT');
    
    return completeHTML;
    
  } catch (error) {
    console.error('❌ Error:', error);
    throw error;
  }
}

// Auto-run
generateFullySentinelReport()
  .then(() => console.log('🎉 Fully automated report complete!'))
  .catch(console.error);

export { generateFullySentinelReport };